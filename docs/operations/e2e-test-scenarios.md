# BOM 구성품 추가 E2E 테스트 시나리오

**테스트 환경:** http://139.59.110.55  
**테스트일:** 2025-10-06  
**담당자:** QA Team

---

## 🧪 시나리오 A: 정상 추가 플로우

### 사전 조건

- [ ] `admin` 계정으로 로그인
- [ ] 빈 BOM 상태의 상품 존재 (또는 새로 생성)

### 테스트 단계

#### Step 1: 첫 번째 구성품 추가

1. **Navigate:** 상품 상세 페이지 (`/items/{item_id}`)
2. **Click:** "BOM 구조" 탭
3. **Verify:** "BOM이 등록되지 않았습니다" 메시지 표시
4. **Click:** "구성품 추가" 버튼
5. **Verify:** 모달 팝업 표시
6. **Type:** 검색창에 "LCD 모듈" 입력
7. **Verify:** 검색 결과에 "LCD 모듈" 표시
8. **Click:** "LCD 모듈" 항목 선택
9. **Verify:** 선택된 구성품 카드 표시
10. **Type:** 수량 `1` 입력 (기본값 확인)
11. **Click:** "추가" 버튼
12. **Wait:** 로딩 스피너 표시
13. **Verify:**
    - ✅ 성공 토스트 메시지: "구성품이 추가되었습니다"
    - ✅ 모달 자동 닫힘
    - ✅ BOM 트리에 "LCD 모듈" 노드 표시
    - ✅ 총 구성품 수: 1개
    - ✅ 총 원가 갱신됨

#### Step 2: 두 번째 구성품 추가

1. **Click:** "구성품 추가" 버튼 (헤더)
2. **Type:** "전원 모듈" 검색
3. **Click:** "전원 모듈 (SMPS)" 선택
4. **Type:** 수량 `1` 입력
5. **Click:** "추가" 버튼
6. **Verify:**
   - ✅ 성공 토스트
   - ✅ BOM 트리에 두 구성품 표시
   - ✅ 총 구성품 수: 2개
   - ✅ 총 원가 갱신됨

### 예상 결과

- ✅ 두 구성품 모두 추가됨
- ✅ 순서대로 표시됨
- ✅ 각 구성품의 단가, 수량, 총 비용 정확
- ✅ 상위 항목의 총 원가 자동 계산

### 실패 시 확인사항

- [ ] 네트워크 탭에서 API 응답 확인
- [ ] Console 로그 확인
- [ ] 백엔드 로그 확인 (`sudo journalctl -u erp-engine -n 50`)

---

## 🧪 시나리오 B: 중복 구성품 시도

### 사전 조건

- [ ] `admin` 계정으로 로그인
- [ ] "LCD 모듈"이 이미 추가된 상태

### 테스트 단계

1. **Click:** "구성품 추가" 버튼
2. **Type:** "LCD 모듈" 검색
3. **Click:** "LCD 모듈" 선택
4. **Type:** 수량 `1` 입력
5. **Click:** "추가" 버튼
6. **Wait:** 로딩 스피너
7. **Verify:**
   - ✅ 에러 토스트: "이미 등록된 구성품입니다" (또는 "Component already exists")
   - ✅ 모달 열린 상태 유지
   - ✅ 선택 항목 초기화되지 않음
   - ✅ BOM 트리 변경 없음

### 복구 테스트

1. **Click:** 검색창 클리어 (X 버튼)
2. **Type:** "전원 케이블" 검색
3. **Click:** "전원 케이블" 선택
4. **Click:** "추가" 버튼
5. **Verify:**
   - ✅ 성공 토스트
   - ✅ "전원 케이블" 정상 추가됨
   - ✅ 이전 에러 상태 완전히 복구

### 예상 결과

- ✅ 중복 추가 방지
- ✅ 명확한 에러 메시지
- ✅ 상태 정상 복구

---

## 🧪 시나리오 C: 권한별 동작 확인

### C-1: Admin 계정

**사전 조건:**

- [ ] `admin / admin123` 로그인

**테스트:**

1. **Navigate:** 상품 상세 → BOM 구조 탭
2. **Verify:**
   - ✅ "구성품 추가" 버튼 **활성화**
   - ✅ 버튼 클릭 가능
   - ✅ 모달 열림
   - ✅ 구성품 추가 가능
3. **Additional:** 구성품 삭제 버튼도 활성화 (향후 구현)

---

### C-2: Staff 계정

**사전 조건:**

- [ ] `staff` 계정 생성 (role: `staff`)
- [ ] Supabase Users 테이블에 추가

**테스트:**

1. **Login:** `staff` 계정
2. **Navigate:** 상품 상세 → BOM 구조 탭
3. **Verify:**
   - ✅ "구성품 추가" 버튼 **활성화**
   - ✅ 구성품 추가 가능
4. **Future:** 단가 편집 제한 (Phase 3)

---

### C-3: Readonly 계정

**사전 조건:**

- [ ] `readonly` 계정 생성 (role: `readonly`)

**테스트:**

1. **Login:** `readonly` 계정
2. **Navigate:** 상품 상세 → BOM 구조 탭
3. **Verify:**
   - ✅ "구성품 추가" 버튼 **비활성화** (회색 처리)
   - ✅ 버튼 클릭 불가
   - ✅ 마우스 호버 시 툴팁: "구성품 추가 권한이 없습니다"
4. **Verify:** BOM 트리는 정상 조회 가능

### 권한 매트릭스

| 권한     | 구성품 추가 | 구성품 삭제 (미래) | 단가 편집 (미래) |
| -------- | ----------- | ------------------ | ---------------- |
| Admin    | ✅          | ✅                 | ✅               |
| Manager  | ✅          | ✅                 | ✅               |
| Staff    | ✅          | ❌                 | ❌               |
| Readonly | ❌          | ❌                 | ❌               |

---

## 🧪 시나리오 D: 네트워크 오류 처리

### 사전 조건

- [ ] Chrome DevTools 열기 (F12)
- [ ] `admin` 계정 로그인

### 테스트 단계

#### D-1: 오프라인 시뮬레이션

1. **Open:** DevTools → Network 탭
2. **Select:** Throttling → "Offline" 선택
3. **Click:** "구성품 추가" 버튼
4. **Select:** 임의 구성품 선택
5. **Click:** "추가" 버튼
6. **Verify:**
   - ✅ 로딩 스피너 표시
   - ✅ 요청 Pending 상태
   - ✅ 타임아웃 후 에러 토스트: "네트워크 오류가 발생했습니다"
   - ✅ 모달 열린 상태 유지
   - ✅ 버튼 재활성화 (중복 요청 방지 해제)

#### D-2: 복구 및 재시도

1. **Select:** Throttling → "No throttling"
2. **Click:** "추가" 버튼 다시 클릭
3. **Verify:**
   - ✅ 정상 추가됨
   - ✅ 성공 토스트
   - ✅ BOM 트리 갱신

#### D-3: 느린 네트워크 (Slow 3G)

1. **Select:** Throttling → "Slow 3G"
2. **Click:** "구성품 추가"
3. **Select:** 구성품 선택
4. **Click:** "추가" 버튼
5. **Verify:**
   - ✅ 로딩 스피너 **오래** 표시
   - ✅ 버튼 비활성화 유지 (중복 클릭 방지)
   - ✅ 최종 성공 토스트
   - ✅ BOM 트리 갱신

### 예상 결과

- ✅ 네트워크 오류 시 명확한 피드백
- ✅ 사용자가 재시도 가능
- ✅ 중복 요청 방지
- ✅ 느린 네트워크에서도 안정적

---

## 🧪 시나리오 E: 순환 참조 방지 (Phase 2.1)

### 사전 조건

- [ ] 백엔드 개선안 적용됨 (간접 순환 참조 체크)
- [ ] 테스트 데이터 준비:
  - A (완제품)
  - B (모듈) - A의 구성품
  - C (부품) - B의 구성품

### E-1: 직접 순환 참조

1. **Navigate:** A 상품 상세
2. **Click:** "구성품 추가"
3. **Select:** A 자기 자신 선택 시도
4. **Click:** "추가"
5. **Verify:**
   - ✅ 에러 토스트: "상품을 자기 자신의 구성품으로 추가할 수 없습니다"
   - ✅ HTTP 409 Conflict

### E-2: 간접 순환 참조

**구조:** A → B → C (정상)  
**시도:** C에 A 추가 (순환!)

1. **Navigate:** C 상품 상세
2. **Click:** "구성품 추가"
3. **Select:** A 선택
4. **Click:** "추가"
5. **Verify:**
   - ✅ 에러 토스트: "순환 참조가 발생합니다"
   - ✅ HTTP 409 Conflict
   - ✅ BOM 변경 없음

### 예상 결과

- ✅ 직접/간접 순환 참조 모두 방지
- ✅ 명확한 에러 메시지
- ✅ 데이터 무결성 보장

---

## 📊 테스트 결과 기록 템플릿

```markdown
## BOM 구성품 추가 E2E 테스트 결과

**테스트 일시:** YYYY-MM-DD HH:MM  
**테스트 환경:** http://139.59.110.55  
**테스터:** [이름]  
**브라우저:** Chrome 120.0.0 (또는 Safari 17.0)

### 시나리오 A: 정상 추가 플로우

- [ ] ✅ Pass / ❌ Fail / ⚠️ Partial
- **비고:**

### 시나리오 B: 중복 구성품 시도

- [ ] ✅ Pass / ❌ Fail / ⚠️ Partial
- **비고:**

### 시나리오 C: 권한별 동작

- C-1 Admin: [ ] ✅ / ❌ / ⚠️
- C-2 Staff: [ ] ✅ / ❌ / ⚠️
- C-3 Readonly: [ ] ✅ / ❌ / ⚠️
- **비고:**

### 시나리오 D: 네트워크 오류

- D-1 Offline: [ ] ✅ / ❌ / ⚠️
- D-2 복구: [ ] ✅ / ❌ / ⚠️
- D-3 Slow 3G: [ ] ✅ / ❌ / ⚠️
- **비고:**

### 시나리오 E: 순환 참조 (Phase 2.1)

- E-1 직접 순환: [ ] ✅ / ❌ / ⚠️ / N/A
- E-2 간접 순환: [ ] ✅ / ❌ / ⚠️ / N/A
- **비고:**

### 발견된 버그

1. [버그 제목] - [심각도: Critical/High/Medium/Low]
   - **재현:** [단계]
   - **예상:** [예상 동작]
   - **실제:** [실제 동작]
   - **스크린샷:** [링크]

### 개선 제안

1. [제안 내용]

### 전체 결과

- **Pass:** N/N 시나리오
- **배포 승인:** ✅ 승인 / ❌ 거부 / ⚠️ 조건부 승인
```

---

## 🛠️ 테스트 도구 및 팁

### Chrome DevTools 단축키

- `F12` - DevTools 열기
- `Ctrl+Shift+M` - 모바일 뷰 토글
- `Ctrl+Shift+P` → "Capture screenshot" - 전체 페이지 캡처

### 네트워크 프로파일 설정

1. DevTools → Network 탭
2. Throttling 드롭다운
3. Custom → Add custom profile
   - Download: 400 Kbps
   - Upload: 400 Kbps
   - Latency: 400 ms
   - 이름: "Bad 3G"

### 콘솔 로그 필터

```javascript
// BOM 관련 로그만 표시
performance.mark('bom-add-start')
// ... 작업 수행
performance.mark('bom-add-end')
performance.measure('bom-add', 'bom-add-start', 'bom-add-end')
console.table(performance.getEntriesByName('bom-add'))
```

### 성능 측정

```javascript
// 브라우저 콘솔에서 실행
const start = performance.now()
// "추가" 버튼 클릭
const end = performance.now()
console.log(`추가 작업 시간: ${(end - start).toFixed(2)}ms`)
```

---

**문서 버전:** v1.0  
**최종 수정:** 2025-10-06  
**담당자:** QA Team
