# ë°°í¬ ì „ ìµœì¢… ì²´í¬ë¦¬ìŠ¤íŠ¸

**ë°°í¬ì¼:** 2025-10-07 (ì›”)  
**ë‹´ë‹¹ì:** Dev Team  
**Phase:** Phase 2 - BOM êµ¬ì„±í’ˆ ì¶”ê°€

---

## âœ… ì‚¬ì „ ì¤€ë¹„ (Pre-deployment)

### 1. ë¡œì»¬ í™˜ê²½ í™•ì¸

- [ ] Git ì‘ì—… ë””ë ‰í† ë¦¬ í´ë¦° ìƒíƒœ í™•ì¸

  ```bash
  cd /Users/kjimi/Documents/GitHub/imac-erp-app
  git status
  # ê²°ê³¼: "nothing to commit, working tree clean"
  ```

- [ ] ìµœì‹  ì½”ë“œ pull í™•ì¸

  ```bash
  git pull origin main
  # ê²°ê³¼: "Already up to date."
  ```

- [ ] ë¡œì»¬ ë¹Œë“œ í…ŒìŠ¤íŠ¸
  ```bash
  npm run build
  # ê²°ê³¼: âœ“ built in XXXms
  ```

---

### 2. ì„œë²„ ì ‘ì† í™•ì¸

- [ ] SSH ì—°ê²° í…ŒìŠ¤íŠ¸

  ```bash
  ssh root@139.59.110.55 "echo 'SSH OK'"
  # ê²°ê³¼: SSH OK
  ```

- [ ] ì„œë²„ ë””ìŠ¤í¬ ê³µê°„ í™•ì¸

  ```bash
  ssh root@139.59.110.55 "df -h"
  # ê²°ê³¼: / íŒŒí‹°ì…˜ ì‚¬ìš©ë¥  < 80%
  ```

- [ ] ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸
  ```bash
  ssh root@139.59.110.55 "systemctl status erp-engine nginx"
  # ê²°ê³¼: active (running)
  ```

---

### 3. ë°±ì—… ì¤€ë¹„

- [ ] ë°±ì—… ë””ë ‰í† ë¦¬ ê³µê°„ í™•ì¸

  ```bash
  ssh root@139.59.110.55 "du -sh /opt/erp-backup/"
  # ì˜ˆìƒ: < 5GB
  ```

- [ ] ì´ì „ ë°±ì—… ì •ë¦¬ (30ì¼ ì´ìƒ ëœ ê²ƒ)
  ```bash
  ssh root@139.59.110.55 "find /opt/erp-backup/ -mtime +30 -type d"
  # í•„ìš” ì‹œ ì‚­ì œ
  ```

---

## ğŸ—„ï¸ DB ë§ˆì´ê·¸ë ˆì´ì…˜ (Critical)

### 1. Supabase í”„ë¡œì íŠ¸ í™•ì¸

- [ ] Supabase Dashboard ë¡œê·¸ì¸
  - URL: https://supabase.com
  - í”„ë¡œì íŠ¸ ì„ íƒ í™•ì¸

- [ ] í˜„ì¬ í…Œì´ë¸” ìƒíƒœ í™•ì¸
  ```sql
  SELECT table_name
  FROM information_schema.tables
  WHERE table_schema = 'public'
  AND table_name LIKE 'bom%';
  ```

  - ì˜ˆìƒ ê²°ê³¼: `bom_components` í…Œì´ë¸” ì¡´ì¬

---

### 2. ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ê²€í† 

- [ ] ë¡œì»¬ì—ì„œ íŒŒì¼ í™•ì¸

  ```bash
  cat backend/supabase/migrations/003_bom_constraints.sql
  ```

- [ ] SQL ë¬¸ë²• ê²€ì¦ (ìœ¡ì•ˆ í™•ì¸)
  - [ ] `ALTER TABLE` êµ¬ë¬¸ í™•ì¸
  - [ ] `CREATE INDEX` êµ¬ë¬¸ í™•ì¸
  - [ ] `CREATE FUNCTION` êµ¬ë¬¸ í™•ì¸

---

### 3. ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰

- [ ] Supabase SQL Editor ì—´ê¸°
- [ ] `003_bom_constraints.sql` ë‚´ìš© ë³µì‚¬
- [ ] ì‹¤í–‰ ë²„íŠ¼ í´ë¦­ (Run)
- [ ] ì‹¤í–‰ ê²°ê³¼ í™•ì¸
  ```
  âœ… UNIQUE ì œì•½ ì¶”ê°€ë¨: unique_parent_component
  âœ… CHECK ì œì•½ ì¶”ê°€ë¨: no_self_reference
  âœ… CHECK ì œì•½ ì¶”ê°€ë¨: valid_quantity
  âœ… ì¸ë±ìŠ¤ ì¶”ê°€ ì™„ë£Œ
  ```

---

### 4. ë§ˆì´ê·¸ë ˆì´ì…˜ ê²€ì¦

- [ ] ì œì•½ ì¡°ê±´ í™•ì¸

  ```sql
  SELECT * FROM check_bom_constraints();
  ```

  - ì˜ˆìƒ ê²°ê³¼: 3ê°œ ì œì•½ ëª¨ë‘ VALID âœ…

- [ ] ì¸ë±ìŠ¤ í™•ì¸

  ```sql
  SELECT * FROM check_bom_indexes();
  ```

  - ì˜ˆìƒ ê²°ê³¼: 4ê°œ ì¸ë±ìŠ¤ ìƒì„± í™•ì¸

- [ ] ì œì•½ í…ŒìŠ¤íŠ¸ (ì¤‘ë³µ ì‚½ì… ì‹œë„)
  ```sql
  -- ì‹¤íŒ¨í•´ì•¼ ì •ìƒ (ì¤‘ë³µ ë°©ì§€)
  INSERT INTO bom_components (parent_item_id, component_item_id, quantity)
  VALUES ('test-id', 'test-id', 1);
  -- ì˜ˆìƒ: ERROR: duplicate key value violates unique constraint
  ```

---

## ğŸ” Go/No-Go ì²´í¬ë¦¬ìŠ¤íŠ¸ ì‹¤í–‰

### ë¸”ë¡ A: ê¸°ëŠ¥/ê¶Œí•œ (4ê°œ í•­ëª©)

#### A-1. ë‹¨ì¼ ë²„íŠ¼ ì»´í¬ë„ŒíŠ¸

- [ ] ë¸Œë¼ìš°ì €ì—ì„œ http://139.59.110.55 ì ‘ì†
- [ ] Hard Reload (Cmd+Shift+R)
- [ ] ë¡œê·¸ì¸: admin / admin123
- [ ] ìƒí’ˆ ìƒì„¸ í˜ì´ì§€ ì´ë™
- [ ] BOM êµ¬ì¡° íƒ­ í´ë¦­
- [ ] "êµ¬ì„±í’ˆ ì¶”ê°€" ë²„íŠ¼ í‘œì‹œ í™•ì¸

#### A-2. RBAC ê¶Œí•œ ì²´í¬

- [ ] admin ê³„ì • â†’ ë²„íŠ¼ í™œì„±í™” í™•ì¸
- [ ] ë¡œê·¸ì•„ì›ƒ â†’ readonly ê³„ì • ë¡œê·¸ì¸
- [ ] ë²„íŠ¼ ë¹„í™œì„±í™” (ë˜ëŠ” ë¯¸í‘œì‹œ) í™•ì¸

#### A-3. ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ì²˜ë¦¬

- [ ] Chrome DevTools â†’ Network â†’ Offline
- [ ] "êµ¬ì„±í’ˆ ì¶”ê°€" ë²„íŠ¼ í´ë¦­
- [ ] ì—ëŸ¬ í† ìŠ¤íŠ¸ í‘œì‹œ í™•ì¸

#### A-4. ì¤‘ë³µ ì¶”ê°€ ì‹œë„

- [ ] ë™ì¼ êµ¬ì„±í’ˆ 2ë²ˆ ì¶”ê°€ ì‹œë„
- [ ] ì—ëŸ¬ ë©”ì‹œì§€ í™•ì¸

**ë¸”ë¡ A ì™„ë£Œìœ¨:** \_\_\_/4 (100% í•„ìˆ˜)

---

### ë¸”ë¡ B: ë°ì´í„° ë¬´ê²°ì„± (4ê°œ í•­ëª©)

#### B-1. ì¤‘ë³µ êµ¬ì„±í’ˆ ë°©ì§€

- [ ] DB ì œì•½ í™•ì¸ (ìœ„ì—ì„œ ì™„ë£Œ)

#### B-2. ìˆœí™˜ ì°¸ì¡° ë°©ì§€

- [ ] ì§ì ‘ ìˆœí™˜ (A â†’ A) í…ŒìŠ¤íŠ¸
- [ ] ë°±ì—”ë“œ ì—ëŸ¬ í™•ì¸

#### B-3. ìˆ˜ëŸ‰ ìœ íš¨ì„±

- [ ] ìˆ˜ëŸ‰ 0 ì…ë ¥ â†’ ì—ëŸ¬
- [ ] ìˆ˜ëŸ‰ 10000 ì…ë ¥ â†’ ì—ëŸ¬

#### B-4. ê¸°íƒ€

- [ ] ì •ìƒ í”Œë¡œìš° í…ŒìŠ¤íŠ¸

**ë¸”ë¡ B ì™„ë£Œìœ¨:** \_\_\_/4 (100% í•„ìˆ˜)

---

### ë¸”ë¡ C: ë°°í¬/ìºì‹œ (3ê°œ í•­ëª©)

#### C-1. VITE_BUILD_ID í™•ì¸

- [ ] ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ í™•ì¸
  ```javascript
  console.log(import.meta.env.VITE_BUILD_ID)
  ```

#### C-2. HTML ìºì‹œ ì •ì±…

- [ ] ìºì‹œ í—¤ë” í™•ì¸
  ```bash
  curl -I http://139.59.110.55/ | grep -i cache-control
  ```

#### C-3. Nginx ë°°í¬ ê²½ë¡œ

- [ ] íŒŒì¼ ì¡´ì¬ í™•ì¸
  ```bash
  ssh root@139.59.110.55 "ls -lh /var/www/erp-app/index.html"
  ```

**ë¸”ë¡ C ì™„ë£Œìœ¨:** \_\_\_/3 (100% í•„ìˆ˜)

---

## ğŸš€ ë°°í¬ ì‹¤í–‰

### 1. ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰

- [ ] ë°°í¬ ëª…ë ¹ ì‹¤í–‰

  ```bash
  ./scripts/deploy-phase2.sh
  ```

- [ ] ê° ë‹¨ê³„ í™•ì¸
  - [ ] Step 1: Git íƒœê·¸ ìƒì„± ì™„ë£Œ
  - [ ] Step 2: ì„œë²„ ë°±ì—… ì™„ë£Œ
  - [ ] Step 3: DB ë§ˆì´ê·¸ë ˆì´ì…˜ í™•ì¸ ì™„ë£Œ
  - [ ] Step 4: í”„ë¡ íŠ¸ì—”ë“œ ë¹Œë“œ ì™„ë£Œ
  - [ ] Step 5: í”„ë¡ íŠ¸ì—”ë“œ ë°°í¬ ì™„ë£Œ
  - [ ] Step 6: Nginx ìºì‹œ ì •ì±… ì ìš© (ì„ íƒ)
  - [ ] Step 7: ë°±ì—”ë“œ í™˜ê²½ë³€ìˆ˜ ì„¤ì •
  - [ ] Step 8: ìŠ¤ëª¨í¬ í…ŒìŠ¤íŠ¸ í†µê³¼

---

### 2. ë°°í¬ í›„ ê²€ì¦ (Post-deployment)

#### ì¦‰ì‹œ í™•ì¸ (ë°°í¬ í›„ 5ë¶„ ì´ë‚´)

- [ ] ë¸Œë¼ìš°ì €ì—ì„œ http://139.59.110.55 ì ‘ì†
- [ ] Hard Reload (Cmd+Shift+R)
- [ ] ë¡œê·¸ì¸ ì„±ê³µ
- [ ] ìƒí’ˆ ëª©ë¡ ë¡œë”© í™•ì¸
- [ ] BOM êµ¬ì¡° íƒ­ ë™ì‘ í™•ì¸
- [ ] "êµ¬ì„±í’ˆ ì¶”ê°€" ë²„íŠ¼ ë™ì‘ í™•ì¸

#### E2E ì‹œë‚˜ë¦¬ì˜¤ A: ì •ìƒ ì¶”ê°€

- [ ] êµ¬ì„±í’ˆ 1ê°œ ì¶”ê°€
- [ ] ì„±ê³µ í† ìŠ¤íŠ¸ í™•ì¸
- [ ] íŠ¸ë¦¬ì— ë°˜ì˜ í™•ì¸

#### E2E ì‹œë‚˜ë¦¬ì˜¤ B: ì¤‘ë³µ ì¶”ê°€

- [ ] ë™ì¼ êµ¬ì„±í’ˆ ì¶”ê°€ ì‹œë„
- [ ] ì—ëŸ¬ í† ìŠ¤íŠ¸ í™•ì¸

#### E2E ì‹œë‚˜ë¦¬ì˜¤ C: ê¶Œí•œë³„ ë™ì‘

- [ ] admin ê³„ì •: ì¶”ê°€ ì„±ê³µ
- [ ] readonly ê³„ì •: ë²„íŠ¼ ë¹„í™œì„±í™”

#### E2E ì‹œë‚˜ë¦¬ì˜¤ D: ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜

- [ ] Offline ëª¨ë“œì—ì„œ ì‹œë„
- [ ] ì¬ì‹œë„ UX í™•ì¸

---

### 3. ëª¨ë‹ˆí„°ë§ í™œì„±í™”

#### ë¡œê·¸ í™•ì¸ (ì‹¤ì‹œê°„)

- [ ] ë°±ì—”ë“œ ë¡œê·¸ ëª¨ë‹ˆí„°ë§ ì‹œì‘
  ```bash
  ssh root@139.59.110.55 "journalctl -u erp-engine -f | grep BOM"
  ```

#### ì—ëŸ¬ ë¡œê·¸ í™•ì¸

- [ ] ìµœê·¼ 10ë¶„ ì—ëŸ¬ í™•ì¸
  ```bash
  ssh root@139.59.110.55 "journalctl -u erp-engine --since '10 minutes ago' | grep ERROR"
  ```

#### Health Check

- [ ] API Health í™•ì¸
  ```bash
  curl http://139.59.110.55/api/v1/health
  # ì˜ˆìƒ: {"status": "ok"}
  ```

---

## ğŸ“Š ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ ì„¤ì •

### 1ì¼ì°¨ (ë°°í¬ì¼)

- [ ] ì‹œê°„ë‹¹ ì„±ê³µ/ì‹¤íŒ¨ ê±´ìˆ˜ ê¸°ë¡
- [ ] ì´ìƒ ì§•í›„ ëª¨ë‹ˆí„°ë§
- [ ] ì‚¬ìš©ì í”¼ë“œë°± ìˆ˜ì§‘

### 3ì¼ì°¨

- [ ] ëˆ„ì  í†µê³„ í™•ì¸
- [ ] ì„±ê³µë¥  ê³„ì‚° (ëª©í‘œ: â‰¥ 95%)
- [ ] p95 ì‘ë‹µì‹œê°„ ì¸¡ì • (ëª©í‘œ: < 300ms)

### 7ì¼ì°¨

- [ ] ì£¼ê°„ ë¦¬í¬íŠ¸ ì‘ì„±
- [ ] Top 3 ì‹¤íŒ¨ ì›ì¸ ë¶„ì„
- [ ] Phase 3 í‚¥ì˜¤í”„ ì¤€ë¹„

---

## ğŸ”„ ë¡¤ë°± ì¤€ë¹„

### ë¡¤ë°± íŠ¸ë¦¬ê±° (ì¦‰ì‹œ ë¡¤ë°±)

- [ ] ì„±ê³µë¥  < 50% (30ë¶„ ì—°ì†)
- [ ] Critical Error ë°œìƒ
- [ ] ì„œë¹„ìŠ¤ ë‹¤ìš´íƒ€ì„ > 5ë¶„

### ë¡¤ë°± ëª…ë ¹

```bash
# ë°±ì—… ë””ë ‰í† ë¦¬ í™•ì¸
ssh root@139.59.110.55 "cat /tmp/last_backup_dir.txt"

# ë¡¤ë°± ì‹¤í–‰
./scripts/rollback-phase2.sh /opt/erp-backup/YYYYMMDD-HHMMSS
```

---

## âœ… ìµœì¢… ìŠ¹ì¸

### Go/No-Go ê²°ì •

- **GO ì¡°ê±´:**
  - [ ] ë¸”ë¡ A: 4/4 (100%)
  - [ ] ë¸”ë¡ B: 4/4 (100%)
  - [ ] ë¸”ë¡ C: 3/3 (100%)
  - [ ] ë¸”ë¡ D: 2/3 (67% ì´ìƒ)

- **NO-GO ì¡°ê±´:**
  - [ ] ë¸”ë¡ A, B, C ì¤‘ í•˜ë‚˜ë¼ë„ < 100%
  - [ ] Critical ì´ìŠˆ ë¯¸í•´ê²°

### ê²°ì •

- [ ] **GO** - ë°°í¬ ì§„í–‰
- [ ] **NO-GO** - ì´ìŠˆ í•´ê²° í›„ ì¬ê²€í† 
- [ ] **CONDITIONAL GO** - ì¡°ê±´ë¶€ ë°°í¬ (ëª¨ë‹ˆí„°ë§ ê°•í™”)

### ìŠ¹ì¸ì ì„œëª…

- **ê²€í† ì:** ************\_************ (ë‚ ì§œ: **\_\_\_**)
- **ìŠ¹ì¸ì:** ************\_************ (ë‚ ì§œ: **\_\_\_**)

---

## ğŸ“ ë°°í¬ ì™„ë£Œ ë³´ê³ 

### ë°°í¬ ì •ë³´

- **ë°°í¬ì¼ì‹œ:** **********\_**********
- **ë°°í¬ ì†Œìš”ì‹œê°„:** **********\_**********
- **Git íƒœê·¸:** **********\_**********
- **ë°±ì—… ë””ë ‰í† ë¦¬:** **********\_**********

### ë°°í¬ ê²°ê³¼

- [ ] ì„±ê³µ
- [ ] ë¶€ë¶„ ì„±ê³µ (ì´ìŠˆ: ********\_\_\_********)
- [ ] ì‹¤íŒ¨ (ì‚¬ìœ : ********\_\_\_********)

### ì´ìŠˆ ë° ëŒ€ì‘

1. ***
2. ***

---

**ì‘ì„±ì¼:** 2025-10-06  
**ìµœì¢… ìˆ˜ì •:** 2025-10-06  
**ë‹´ë‹¹ì:** Dev Team
